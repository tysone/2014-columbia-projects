YUI.add("hermes-template-context",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n	<a href="',(i=n.url)?i=i.call(e,{hash:{},data:t}):(i=e.url,i=typeof i===o?i.apply(e):i),r+=u(i)+'">',(i=n.title)?i=i.call(e,{hash:{},data:t}):(i=e.title,i=typeof i===o?i.apply(e):i),r+=u(i)+" ",i=n["if"].call(e,e.displayType,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;r+="</a>\n	\n	<ul>\n	",i=n.each.call(e,e.photoList,{hash:{},inverse:f.noop,fn:f.programWithDepth(4,h,t,e),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n",r}function c(e,t){var r="",i;return r+="(",(i=n.displayType)?i=i.call(e,{hash:{},data:t}):(i=e.displayType,i=typeof i===o?i.apply(e):i),r+=u(i)+")",r}function h(e,t,r){var i="",s,o,l;i+='\n		<li>\n			<a href="',l={hash:{},data:t},i+=u((s=n.urlPhoto||e.urlPhoto,s?s.call(e,e,r.contextSuffix,l):a.call(e,"urlPhoto",e,r.contextSuffix,l)))+'" data-track="contextPhotoThumbnailClick">\n		',o=n["if"].call(e,e.needsInterstitial,{hash:{},inverse:f.program(7,d,t),fn:f.program(5,p,t),data:t});if(o||o===0)i+=o;return i+="\n			</a>\n		</li>\n	",i}function p(e,t){return'\n				<img class="restrictedImage" src="http://l.yimg.com/g/images/spaceout.gif" height="69" width="69"/>\n		'}function d(e,t){var n="",r;return n+='\n				<img src="'+u((r=(r=(r=e.sizes,r==null||r===!1?r:r.sq),r==null||r===!1?r:r.url),typeof r===o?r.apply(e):r))+'" height="69" width="69" />\n		',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n["if"].call(t,t.photoList,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i}),s||s===0?s:""}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/context",function(e){return n(e,{partials:r})})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("context-view",function(e){e.namespace("Views")[this.name]=e.Base.create("context-view",e.FlickrView,[],{initializer:function(t){return this.photoId=t.photoId,this.nsid=t.nsid,this.context=e.clone(t.context,!0),this.perPage=t.perPage,this.page=t.page||1,this.numPrev=t.numPrev,this.numNext=t.numNext,this.displayNum=t.displayNum||4,this.usePageFetcher=t.usePageFetcher,this.get("container").html===""&&this.setContainerHTML(""),this},loadState:function(){var t=this;return t.appContext.getModel(t.context.modelName,t.context.params).then(function(n){return t.set("model",n),t.usePageFetcher?n.getValue("photoPageList").getPage(e.merge(t.context.params,{page:t.page,perPage:t.perPage})):n.getValue("photoContextList").getContext(e.merge(t.context.params,{photoId:t.photoId,numPrev:t.numPrev,numNext:t.numNext}))}).then(function(e){typeof e=="undefined"?e=[]:t.usePageFetcher||(e=e.next||[]),t.set("list",e),e.length>4&&(t.registerEventHandler(t.on("flickr:photo-charm-contexts-view--duplicate-context-photos",function(n){var r=n.details[0],i;r.length>e.length-4&&(r.length=e.length-4),i=e.filter(function(e){return r.indexOf(e.getValue("id"))===-1}),t.set("list",i),t.detach("flickr:photo-charm-contexts-view--duplicate-context-photos")})),t.fire("flickr:photo-charm-contexts-view--track-context-photos",e.map(function(e){return e.getValue("id")})))})},buildContainer:function(){var e,t=this.get("model"),n,r;return n=t.toJSON(),this.get("list")&&this.get("list").slice&&(this.usePageFetcher?r=this.perPage:r=this.numNext,n.photoList=this.get("list").slice(0,r).map(function(e){return e.toJSON()}).slice(0,this.displayNum)),n.contextSuffix=t.getValue("urlSuffix"),["photostream","favorites","related favorites","photos of","contacts"].indexOf(n.displayType)>-1&&(n.displayType=null),this.get("container").setAttribute("data-context-id",t.id),e=this.templates("context")(n),this.setContainerHTML(e),this},activate:function(){return this}})},"@VERSION@",{requires:["flickr-view","hermes-template-context","context-css"]});
